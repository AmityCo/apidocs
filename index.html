<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Amity API</title>
  <!-- Embed elements Elements via Web Component -->
  <link rel="stylesheet" href="https://unpkg.com/@stoplight/elements/styles.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-theme-classic" />
  <link rel="stylesheet" type="text/css" href="dist/style.css">
  <script src="dist/js-yaml.min.js"></script>
  <script src="https://unpkg.com/@stoplight/elements/web-components.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-js"></script>
  <script type="text/javascript">
    window.onload = function () {

      const xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://raw.githubusercontent.com/AmityCo/apidocs/develop/swagger.yaml', true);
      xhr.onreadystatechange = function () {
        if (this.readyState === 4 && this.status === 200) {
          const { autocomplete } = window['@algolia/autocomplete-js'];

          const yamlData = this.responseText;
          const parsedData = jsyaml.load(yamlData);

          const index = [];

          for (const url in parsedData.paths) {
            const path = parsedData.paths[url];
            for (const type in path) {
              if (type !== "$ref") {
                const detail = path[type];
                index.push({
                  text: `${type.toUpperCase()} ${url}`,
                  value: `#/paths/${url.substring(1).split('/').join('-')}/${type}`,
                  description: detail.description
                })
              }
            }
          }

          const autocompleteInstance = autocomplete({
            container: '#search',
            placeholder: 'Search API...',
            getSources({ query }) {
              return [
                {
                  sourceId: 'links',
                  getItems({ query }) {
                    return index.filter(function ({ text }) {
                      if (this.count < 10 && text.indexOf(query) > -1) {
                        this.count++;
                        return true;
                      }
                      return false;
                    }, { count: 0 });
                  },
                  getItemUrl({ item }) {
                    return item.value;
                  },
                  templates: {
                    item({ item, html }) {
                      return html`<div class="sl-pt-1 sl-pb-1">
                        <a href="${item.value}">
                          <div class="sl-flex sl-items-center">
                            <div class="sl-flex-1 sl-text-lg sl-font-medium sl-overflow-ellipsis sl-mx-2">${item.text}</div>
                          </div>
                          <div class="sl-text-sm sl-mt-1 sl-ml-2 sl-mr-2 sl-text-muted">${item.description}</div>
                        </a>
                      </div>`;
                    },
                  },
                },
              ];
            },
          });

          addEventListener("hashchange", (event) => { });
          onhashchange = (event) => {
            autocompleteInstance.setQuery('');
            document.documentElement.scrollTop = 0;
          };

          document.documentElement.scrollTop = 0;
        }
      };
      xhr.send();
    }
  </script>
</head>

<body>
  <div id="search"></div>
  <elements-api apiDescriptionUrl="https://raw.githubusercontent.com/AmityCo/apidocs/develop/swagger.yaml" router="hash"
    layout="sidebar">
  </elements-api>
</body>

</html>